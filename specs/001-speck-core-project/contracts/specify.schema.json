{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://speck.dev/schemas/commands/specify.json",
  "title": "Specify Command Contract",
  "description": "Contract for the /speck.specify command and `speck specify` CLI command",
  "type": "object",
  "properties": {
    "command": {
      "type": "string",
      "const": "specify",
      "description": "Command name"
    },
    "input": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string",
          "minLength": 10,
          "maxLength": 1000,
          "description": "Natural language feature description"
        },
        "shortName": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "minLength": 3,
          "maxLength": 50,
          "description": "Optional short name (auto-generated if omitted)"
        },
        "number": {
          "type": "integer",
          "minimum": 1,
          "maximum": 999,
          "description": "Optional feature number (auto-assigned if omitted)"
        },
        "useWorktree": {
          "type": "boolean",
          "default": false,
          "description": "Create feature as git worktree"
        },
        "worktreePath": {
          "type": "string",
          "description": "Custom worktree path (optional, defaults to config.worktree.baseDir)"
        },
        "json": {
          "type": "boolean",
          "default": false,
          "description": "Output JSON instead of interactive prompts (CLI only)"
        }
      },
      "required": ["description"],
      "additionalProperties": false
    },
    "output": {
      "type": "object",
      "properties": {
        "feature": {
          "type": "object",
          "properties": {
            "number": {
              "type": "integer",
              "minimum": 1,
              "maximum": 999
            },
            "shortName": {
              "type": "string",
              "pattern": "^[a-z0-9-]+$"
            },
            "branchName": {
              "type": "string",
              "pattern": "^\\d{3}-[a-z0-9-]+$"
            },
            "description": {
              "type": "string"
            },
            "directory": {
              "type": "string"
            },
            "mode": {
              "type": "string",
              "enum": ["branch", "worktree", "non-git"]
            },
            "worktreePath": {
              "type": "string"
            }
          },
          "required": ["number", "shortName", "branchName", "description", "directory", "mode"]
        },
        "specification": {
          "type": "object",
          "properties": {
            "filePath": {
              "type": "string"
            },
            "clarificationMarkersCount": {
              "type": "integer",
              "minimum": 0,
              "maximum": 3
            },
            "validation": {
              "type": "object",
              "properties": {
                "isValid": { "type": "boolean" },
                "errors": { "type": "array", "items": { "type": "object" } },
                "warnings": { "type": "array", "items": { "type": "object" } }
              },
              "required": ["isValid", "errors", "warnings"]
            }
          },
          "required": ["filePath", "clarificationMarkersCount", "validation"]
        },
        "checklist": {
          "type": "object",
          "properties": {
            "filePath": {
              "type": "string"
            },
            "itemCount": {
              "type": "integer",
              "minimum": 1
            }
          },
          "required": ["filePath", "itemCount"]
        },
        "nextSteps": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Suggested next commands"
        }
      },
      "required": ["feature", "specification", "checklist", "nextSteps"]
    },
    "errors": {
      "type": "object",
      "properties": {
        "branchNameTooLong": {
          "type": "object",
          "properties": {
            "code": { "type": "string", "const": "BRANCH_NAME_TOO_LONG" },
            "message": { "type": "string" },
            "branchName": { "type": "string" },
            "length": { "type": "integer" },
            "maxLength": { "type": "integer", "const": 244 }
          }
        },
        "duplicateShortName": {
          "type": "object",
          "properties": {
            "code": { "type": "string", "const": "DUPLICATE_SHORT_NAME" },
            "message": { "type": "string" },
            "shortName": { "type": "string" },
            "existingBranch": { "type": "string" },
            "resolvedName": { "type": "string" }
          }
        },
        "invalidDescription": {
          "type": "object",
          "properties": {
            "code": { "type": "string", "const": "INVALID_DESCRIPTION" },
            "message": { "type": "string" }
          }
        }
      }
    }
  },
  "required": ["command", "input", "output"],
  "examples": [
    {
      "command": "specify",
      "input": {
        "description": "Add user authentication with email and password",
        "json": true
      },
      "output": {
        "feature": {
          "number": 1,
          "shortName": "user-authentication",
          "branchName": "001-user-authentication",
          "description": "Add user authentication with email and password",
          "directory": "/path/to/repo/specs/001-user-authentication",
          "mode": "branch"
        },
        "specification": {
          "filePath": "/path/to/repo/specs/001-user-authentication/spec.md",
          "clarificationMarkersCount": 2,
          "validation": {
            "isValid": true,
            "errors": [],
            "warnings": []
          }
        },
        "checklist": {
          "filePath": "/path/to/repo/specs/001-user-authentication/checklists/requirements.md",
          "itemCount": 15
        },
        "nextSteps": [
          "speck clarify",
          "speck plan"
        ]
      }
    }
  ]
}
