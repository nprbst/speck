{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://speck.dev/schemas/specify.json",
  "title": "Specify Command Contract",
  "description": "Contract for the /speck.specify command - creates a new feature specification from a natural language description",
  "type": "object",
  "properties": {
    "input": {
      "type": "object",
      "description": "Input parameters for specification creation",
      "properties": {
        "description": {
          "type": "string",
          "description": "Natural language feature description",
          "minLength": 10,
          "maxLength": 1000
        },
        "worktreeMode": {
          "type": "boolean",
          "description": "Whether to create git worktree for isolated development",
          "default": false
        }
      },
      "required": ["description"]
    },
    "output": {
      "type": "object",
      "description": "Output from successful specification creation",
      "properties": {
        "feature": {
          "type": "object",
          "description": "Created feature metadata",
          "properties": {
            "number": {
              "type": "integer",
              "description": "3-digit zero-padded feature number",
              "minimum": 1,
              "maximum": 999
            },
            "shortName": {
              "type": "string",
              "description": "Kebab-case short name (2-4 words)",
              "pattern": "^[a-z0-9-]+$",
              "maxLength": 200
            },
            "branchName": {
              "type": "string",
              "description": "Git branch name: {number}-{shortName}",
              "pattern": "^\\d{3}-[a-z0-9-]+$",
              "maxLength": 244
            },
            "directoryPath": {
              "type": "string",
              "description": "Absolute path to feature's specs directory",
              "pattern": "^/.*specs/\\d{3}-[a-z0-9-]+/$"
            },
            "status": {
              "type": "string",
              "description": "Initial feature status",
              "enum": ["draft"]
            },
            "worktreePath": {
              "type": ["string", "null"],
              "description": "Absolute path to worktree directory (if worktree mode used)"
            }
          },
          "required": ["number", "shortName", "branchName", "directoryPath", "status"]
        },
        "specification": {
          "type": "object",
          "description": "Generated specification metadata",
          "properties": {
            "filePath": {
              "type": "string",
              "description": "Absolute path to spec.md file",
              "pattern": "^/.*specs/\\d{3}-[a-z0-9-]+/spec\\.md$"
            },
            "clarificationMarkersCount": {
              "type": "integer",
              "description": "Number of [NEEDS CLARIFICATION] markers",
              "minimum": 0,
              "maximum": 3
            },
            "qualityCheckPassed": {
              "type": "boolean",
              "description": "Whether spec passed automated quality validation"
            }
          },
          "required": ["filePath", "clarificationMarkersCount", "qualityCheckPassed"]
        }
      },
      "required": ["feature", "specification"]
    },
    "errors": {
      "type": "object",
      "description": "Possible error cases",
      "properties": {
        "NOT_GIT_REPO": {
          "type": "object",
          "description": "Error when invoked in non-git directory",
          "properties": {
            "code": {
              "type": "string",
              "const": "NOT_GIT_REPO"
            },
            "message": {
              "type": "string",
              "const": "Speck requires git. Please run 'git init' to initialize a repository, or use 'git clone' if working with an existing project."
            },
            "exitCode": {
              "type": "integer",
              "const": 1
            }
          }
        },
        "DUPLICATE_SHORT_NAME": {
          "type": "object",
          "description": "Warning when short-name collides with existing feature",
          "properties": {
            "code": {
              "type": "string",
              "const": "DUPLICATE_SHORT_NAME"
            },
            "message": {
              "type": "string",
              "pattern": "^Feature '.*' already exists\\. Created '.*' with collision counter\\. Review existing feature before proceeding\\.$"
            },
            "existingFeature": {
              "type": "string",
              "description": "Existing feature identifier"
            },
            "newFeature": {
              "type": "string",
              "description": "New feature identifier with collision counter"
            }
          }
        },
        "BRANCH_NAME_TOO_LONG": {
          "type": "object",
          "description": "Error when branch name would exceed git's 244-character limit",
          "properties": {
            "code": {
              "type": "string",
              "const": "BRANCH_NAME_TOO_LONG"
            },
            "message": {
              "type": "string",
              "pattern": "^Branch name truncated from .* to .* to fit git's 244-character limit\\.$"
            },
            "originalLength": {
              "type": "integer"
            },
            "truncatedName": {
              "type": "string",
              "maxLength": 244
            }
          }
        }
      }
    }
  },
  "required": ["input", "output", "errors"]
}
