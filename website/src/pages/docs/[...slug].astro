---
/**
 * Dynamic Documentation Page
 * Renders markdown documentation with sidebar navigation and table of contents
 */

import { getCollection, getEntry } from 'astro:content';
import DocsLayout from '@/layouts/DocsLayout.astro';
import type { CollectionEntry } from 'astro:content';

export const prerender = true;

export async function getStaticPaths() {
  const docs = await getCollection('docs');
  // Filter out draft and redirect pages (redirects only appear in sidebar, no rendered page)
  const publishedDocs = docs.filter(doc => !doc.data.draft && !doc.data.redirect);

  return publishedDocs.map(doc => ({
    params: { slug: doc.slug },
    props: { doc },
  }));
}

interface Props {
  doc: CollectionEntry<'docs'>;
}

const { doc } = Astro.props;
const { Content, headings } = await doc.render();

// Get all docs for sidebar (filter out drafts, include redirects for nav)
const allDocs = await getCollection('docs');
const docsForSidebar = allDocs
  .filter(d => !d.data.draft)
  .map(d => ({
    slug: d.slug,
    title: d.data.title,
    category: d.data.category,
    order: d.data.order,
    redirect: d.data.redirect,
  }));
---

<DocsLayout
  title={doc.data.title}
  description={doc.data.description}
  slug={doc.slug}
  category={doc.data.category}
  headings={headings}
  allDocs={docsForSidebar}
>
  <Content />
</DocsLayout>
