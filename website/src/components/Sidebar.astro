---
/**
 * Sidebar Navigation Component
 * Hierarchical documentation navigation with collapsible sections
 */

interface DocEntry {
  slug: string;
  title: string;
  category: string;
  order: number;
  redirect?: string;
}

interface Props {
  docs: DocEntry[];
  currentSlug?: string;
}

const { docs, currentSlug } = Astro.props;

// Group docs by category
const categories = docs.reduce((acc, doc) => {
  if (!acc[doc.category]) {
    acc[doc.category] = [];
  }
  acc[doc.category].push(doc);
  return acc;
}, {} as Record<string, DocEntry[]>);

// Sort docs within each category by order
Object.keys(categories).forEach(category => {
  categories[category].sort((a, b) => a.order - b.order);
});

// Category display names
const categoryNames: Record<string, string> = {
  'getting-started': 'Getting Started',
  'core-concepts': 'Core Concepts',
  'advanced-features': 'Advanced Features',
  'architecture': 'Architecture',
  'examples': 'Examples',
  'commands': 'Commands',
  'reference': 'Reference',
  'community': 'Community',
};

// Category order
const categoryOrder = ['getting-started', 'core-concepts', 'advanced-features', 'architecture', 'examples', 'commands', 'reference', 'community'];
---

<aside class="sidebar">
  <nav class="sidebar-nav" aria-label="Documentation navigation">
    {categoryOrder.filter(cat => categories[cat]).map(category => (
      <section class="sidebar-section">
        <h3 class="sidebar-category">{categoryNames[category] || category}</h3>
        <ul class="sidebar-list">
          {categories[category].map(doc => (
            <li class="sidebar-item">
              <a
                href={doc.redirect || `/docs/${doc.slug}`}
                class:list={['sidebar-link', { active: currentSlug === doc.slug }]}
                aria-current={currentSlug === doc.slug ? 'page' : undefined}
              >
                {doc.title}
              </a>
            </li>
          ))}
        </ul>
      </section>
    ))}
  </nav>
</aside>

<script>
  // Update active state on navigation (needed because sidebar persists with transition:persist)
  document.addEventListener('astro:page-load', () => {
    const currentPath = window.location.pathname;
    const links = document.querySelectorAll('.sidebar-link');

    links.forEach(link => {
      const href = link.getAttribute('href');
      const isActive = currentPath === href || currentPath === href + '/';

      if (isActive) {
        link.classList.add('active');
        link.setAttribute('aria-current', 'page');
      } else {
        link.classList.remove('active');
        link.removeAttribute('aria-current');
      }
    });
  });
</script>

<style>
  .sidebar {
    background-color: var(--color-surface);
    border-right: 1px solid var(--color-border);
    height: calc(100vh - 60px);
    position: sticky;
    top: 60px;
    overflow-y: auto;
    padding: 2rem 1.5rem;
    min-width: 250px;
    max-width: 280px;
    direction: rtl; /* Move scrollbar to left edge */
  }

  .sidebar-nav {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    direction: ltr; /* Reset text direction for content */
  }

  .sidebar-section {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .sidebar-category {
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-secondary);
    margin: 0;
  }

  .sidebar-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .sidebar-item {
    margin: 0;
  }

  .sidebar-link {
    display: block;
    padding: 0.5rem 0.75rem;
    color: var(--color-text);
    text-decoration: none;
    border-radius: 0.375rem;
    font-size: 0.9375rem;
    transition: background-color 0.15s, color 0.15s;
  }

  .sidebar-link:hover {
    background-color: var(--color-hover);
    color: var(--color-accent);
  }

  .sidebar-link.active {
    background-color: var(--color-accent-subtle);
    color: var(--color-accent);
    font-weight: 500;
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .sidebar {
      position: fixed;
      left: 0;
      top: 60px; /* Below header */
      width: 280px;
      height: calc(100vh - 60px);
      transform: translateX(-100%);
      transition: transform 0.3s;
      z-index: 100;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
    }

    .sidebar.open {
      transform: translateX(0);
    }
  }

  /* Scrollbar styling */
  .sidebar::-webkit-scrollbar {
    width: 8px;
  }

  .sidebar::-webkit-scrollbar-track {
    background: transparent;
  }

  .sidebar::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 4px;
  }

  .sidebar::-webkit-scrollbar-thumb:hover {
    background: var(--color-hover);
    opacity: 0.8;
  }
</style>
